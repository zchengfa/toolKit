<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: utils.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: utils.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ajax = exports.timeFormatting = exports.base64 = exports.getPropertyArray = void 0;
/**
 * @description 防抖函数：设定时间，在时间内函数调用了，停止执行函数，重新设定时间，只有设定时间到了才会执行一次
 * @param func { Function } 需要防抖处理的函数
 * @param delay { number } 延迟时间
 * @return { Function } 返回具备防抖能力的函数
 * @example const debounceFun = debounce(func,2000) ; debounceFun()
 * @author zcf
 */
function debounce(func, delay) {
    var timer;
    return function () {
        var _this = this;
        var args = [];
        for (var _i = 0; _i &lt; arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        if (timer) {
            clearTimeout(timer);
        }
        timer = setTimeout(function () {
            func.apply(_this, args);
        }, delay);
    };
}
/**
 * @description 节流函数：不管你在设置时间内调用函数，都只会再设定时间到了后执行一次
 * @param func { Function } 需要节流处理的函数
 * @param delay { number } 延迟时间
 * @return { Function } 返回具备节流能力的函数
 * @example const throttleFun = throttle(func,2000) ; throttleFun()
 * @author zcf
 */
function throttle(func, delay) {
    var flag = true;
    return function () {
        var _this = this;
        var args = [];
        for (var _i = 0; _i &lt; arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        if (flag) {
            setTimeout(function () {
                func.apply(_this, args);
                flag = true;
            }, delay);
        }
        flag = false;
    };
}
/**
 * @description 将一个以对象组成的数组进行排序
 * @param sortArray { Array } 需要进行排序的数组
 * @param sortProperty { string } 根据对象的哪个属性来排序
 * @return { Array } 返回排序后的数组
 * @example bubbleSort(arr,'price')
 * @author zcf
 */
function bubbleSort(sortArray, sortProperty) {
    var length = sortArray.length;
    for (var i = length - 1; 0 &lt; i; i--) {
        for (var j = 0; j &lt; i; j++) {
            if (sortArray[j][sortProperty] > sortArray[j + 1][sortProperty]) {
                var temp = sortArray[j];
                sortArray[j] = sortArray[j + 1];
                sortArray[j + 1] = temp;
            }
        }
    }
    return sortArray;
}
/**
 * @description 使用for循环加push的方式反转数组
 * @param reArray { Array } 需要反转的数组
 * @return { Array } 返回反转后的数组
 * @author zcf
 */
function reverseArray(reArray) {
    var returnArray = [];
    for (var i = reArray.length - 1; 0 &lt;= i; i--) {
        returnArray.push(reArray[i]);
    }
    return returnArray;
}
/**
 * @description 将手机号的中间四位进行带*号处理
 * @param phone { string } 手机号
 * @return { string } 返回带*号后的手机号
 * @author zcf
 */
function dealPhoneByStars(phone) {
    return phone.replace(/(\d{3})\d*(\d{4})/, '$1****$2');
}
/**
 * @function getPropertyArray 用于获取数组或对象中需要的属性名，将属性名加入到新数组中并返回
 * @description _propertyArray 是一个用于存储属性名的数组
 * @param array 接收一个数组
 * @author zcf
 */
function getPropertyArray(array) {
    var _propertyArray = [];
    for (var arrayKey in array) {
        _propertyArray.push(arrayKey);
    }
    return _propertyArray;
}
exports.getPropertyArray = getPropertyArray;
/**
 * @description 获取当前的年月日
 * @param split { string } 分隔符
 * @return { string } 返回带有分隔符的年月日
 * @author zcf
 */
function getYMDate(split) {
    if (split === void 0) { split = '-'; }
    var now = new Date();
    return now.getFullYear() + split + ((now.getMonth()) + 1) + split + now.getDate();
}
/**
 * @description 获取今日属于星期几或周几
 * @param character { number } [0,1] - 星期或周
 * @return { string } 时间
 */
function getWeek(character) {
    if (character === void 0) { character = 0; }
    var day = new Date().getDay(), week = ['天', '一', '二', '三', '四', '五', '六',], today;
    var weekType = character === 0 ? '周' : '星期';
    if (character === 0) {
        week[0] = '末';
    }
    week.forEach(function (item, index) {
        index === day ? today = item : null;
    });
    return weekType + today;
}
/**
 * @description 将table中的数据转成excel表格
 * @param data { Array } 表格数据
 * @author zcf
 */
function tableToExcel(data) {
    var head = "&lt;tr class=\"table-header\">&lt;td>\u5546\u54C1id&lt;/td>&lt;td>\u5546\u54C1\u6807\u9898&lt;/td>&lt;td>\u56FE\u7247&lt;/td>&lt;td>\u4EF7\u683C&lt;/td>&lt;td>\u5E93\u5B58&lt;/td>&lt;/tr>";
    var tbody = ""; //内容
    for (var item in data) {
        tbody +=
            "&lt;tr class=\"product\">\n                                     &lt;td class=\"id\">".concat(data[item]['id'] + '\t', "&lt;/td>\n                                     &lt;td class=\"title\">").concat(data[item]['title'] + '\t', "&lt;/td>\n                                     &lt;td class=\"path\">").concat(data[item]['imagePath'] + '\t', "&lt;/td>\n                                     &lt;td class=\"price\">\uFFE5").concat(data[item]['price'] + '\t', "&lt;/td>\n                                     &lt;td class=\"stocks\">").concat(data[item]['count'] + '\t', "&lt;/td>\n                                 &lt;/tr>");
    }
    var str = head + tbody; //头部跟身体内容连接
    //Worksheet名
    var worksheet = '商品数据';
    var uri = 'data:application/vnd.ms-excel;base64,';
    //下载的表格模板数据(需要设置编码格式utf-8，不设置会在打开Excel文件时会乱码)
    var template = "&lt;html xmlns:o=\"urn:schemas-microsoft-com:office:office\"\n                               xmlns:x=\"urn:schemas-microsoft-com:office:excel\"\n                               xmlns=\"http://www.w3.org/TR/REC-html40\" lang=\"en\">\n                               &lt;head>&lt;!--[if gte mso 9]>&lt;xml>&lt;x:ExcelWorkbook>&lt;x:ExcelWorksheets>&lt;x:ExcelWorksheet>\n                                 &lt;x:Name>".concat(worksheet, "&lt;/x:Name>\n                                 &lt;x:WorksheetOptions>&lt;x:DisplayGridlines/>&lt;/x:WorksheetOptions>&lt;/x:ExcelWorksheet>\n                                 &lt;/x:ExcelWorksheets>&lt;/x:ExcelWorkbook>&lt;/xml>&lt;![endif]-->\n                                 &lt;meta charset=\"UTF-8\">\n                                 &lt;style type=\"text/css\">\n                                    .table-header td{\n                                         padding: 16px;\n                                         height: 60px;\n                                         text-align: center;\n                                         color: #FFFFFF;\n                                         background-color: #1e8efc;\n                                         border: 1px solid #8a8a8a;\n                                    }\n                                    .product{\n                                         text-align: center;\n                                    }\n                                    td{\n                                         padding: 16px;\n                                    }\n\n                                    .id{\n                                         color: #1e8efc;\n                                    }\n                                    .title{\n                                         color: #d91868;\n                                    }\n                                    .path{\n                                         color: orchid;\n                                         font-weight: bold;\n                                    }\n                                    .price{\n                                         width: 100px;\n                                         color: red;\n                                    }\n                                    .stocks{\n                                         width: 100px;\n\n                                    }\n                                 &lt;/style>&lt;title>&lt;/title>\n                                 &lt;/head>&lt;body>&lt;table>").concat(str, "&lt;/table>&lt;/body>&lt;/html>");
    //下载模板
    window.location.href = uri + base64(template);
}
//输出base64编码
function base64(s) {
    return window.btoa(unescape(encodeURIComponent(s)));
}
exports.base64 = base64;
/**
 * @description 时间格式化函数
 * @param time { number } 时间
 * @param fm { string } 时间样式
 * @return { string } 返回格式化后的时间
 */
function timeFormatting(time, fm) {
    if (fm === void 0) { fm = 'YYYY-MM-DD hh:mm:ss'; }
    //拓展Date的时间格式化函数
    //@ts-ignore
    Date.prototype.format = function (fmt) {
        var formatObject = {
            "M+": this.getMonth() + 1,
            "d+": this.getDate(),
            "h+": this.getHours(),
            "m+": this.getMinutes(),
            "s+": this.getSeconds(),
            "q+": Math.floor((this.getMonth() + 3) / 3),
            "S": this.getMilliseconds() //毫秒
        };
        //  获取年份
        // ①
        if (/(y+)/i.test(fmt)) {
            fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        }
        for (var k in formatObject) {
            // ②
            if (new RegExp("(" + k + ")", "i").test(fmt)) {
                fmt = fmt.replace(
                //@ts-ignore
                RegExp.$1, (RegExp.$1.length === 1) ? (formatObject[k]) : (("00" + formatObject[k]).substr(("" + formatObject[k]).length)));
            }
        }
        return fmt;
    };
    if (time) {
        return time.format(fm);
    }
    else {
        //@ts-ignore
        return new Date().format(fm);
    }
}
exports.timeFormatting = timeFormatting;
/**
 * @description 将数据拼接成url参数
 * @param data { any }
 * @return { string } 返回url参数形式的字符串
 * @author zcf
 */
function appendUrlParams(data) {
    var paramsArr = [];
    //遍历data对象
    for (var key in data) {
        //参数加上=号并使用encodeURIComponent对参数中的特殊字符进行转义避免内容丢失造成读取数据失败，最后将其push到新数组中
        // @ts-ignore
        paramsArr.push("".concat(key, "=").concat(encodeURIComponent(paramsArr[key])));
    }
    //将数组中的元素转换成字符串后返回
    return paramsArr.join('&amp;');
}
/**
 * @description 手写ajax
 * @param options { Object } 配置项
 * @param options.url { string } 请求地址
 * @param options.method { 'GET' | 'POST' } 请求方式
 * @param options.data { Object } 参数
 * @param options.timeout { number } 超时时间
 * @return { Promise } 返回一个promise
 * @example  ajax({
 *     url:'url',
 *     method:'get',
 *     timeout:3000,
 *     data:{},
 *     async:true
 * }).then()
 * @author zcf
 */
function ajax(options) {
    if (options === void 0) { options = { url: '', method: 'GET', data: {}, timeout: 3000, async: true }; }
    // @ts-ignore
    return new Promise(function (resolve, reject) {
        if (!options.url)
            throw Error('URL is required!');
        var xhr;
        //创建ActiveXObject时ts报错，去tsconfig.json文件中启用scripthost库
        window.XMLHttpRequest ? xhr = new XMLHttpRequest() : xhr = new ActiveXObject("Microsoft.XMLHTTP");
        //参数拼接用于GET请求
        var queryParams = appendUrlParams(options.data);
        //设置请求头
        var headers = options.headers || { "Content-type": "application/json;charset=UTF-8" };
        //Object.keys方法获取对象中的属性名返回一个数组
        Object.keys(headers).forEach(function (key) {
            //@ts-ignore
            xhr.setRequestHeader(key, headers[key]);
        });
        //超时处理
        xhr.timeout = options.timeout;
        xhr.ontimeout = function () {
            reject('请求超时！');
        };
        //连接
        //将请求方式参数转换成全大写
        // @ts-ignore
        var method = options.method.toUpperCase();
        if (method === 'GET') {
            xhr.open('get', "".concat(options.url, "?").concat(queryParams), options.async);
            xhr.send();
        }
        else if (method === 'POST') {
            xhr.open('post', options.url, options.async);
            xhr.send(options.data);
        }
        //接收
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                (xhr.status >= 200 &amp;&amp; xhr.status &lt;= 300 || xhr.status === 304) ? resolve(xhr.responseText) : reject(xhr.status);
            }
        };
    });
}
exports.ajax = ajax;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#ajax">ajax</a></li><li><a href="global.html#appendUrlParams">appendUrlParams</a></li><li><a href="global.html#bubbleSort">bubbleSort</a></li><li><a href="global.html#dealPhoneByStars">dealPhoneByStars</a></li><li><a href="global.html#debounce">debounce</a></li><li><a href="global.html#getPropertyArray%25E7%2594%25A8%25E4%25BA%258E%25E8%258E%25B7%25E5%258F%2596%25E6%2595%25B0%25E7%25BB%2584%25E6%2588%2596%25E5%25AF%25B9%25E8%25B1%25A1%25E4%25B8%25AD%25E9%259C%2580%25E8%25A6%2581%25E7%259A%2584%25E5%25B1%259E%25E6%2580%25A7%25E5%2590%258D%25EF%25BC%258C%25E5%25B0%2586%25E5%25B1%259E%25E6%2580%25A7%25E5%2590%258D%25E5%258A%25A0%25E5%2585%25A5%25E5%2588%25B0%25E6%2596%25B0%25E6%2595%25B0%25E7%25BB%2584%25E4%25B8%25AD%25E5%25B9%25B6%25E8%25BF%2594%25E5%259B%259E">getPropertyArray 用于获取数组或对象中需要的属性名，将属性名加入到新数组中并返回</a></li><li><a href="global.html#getWeek">getWeek</a></li><li><a href="global.html#getYMDate">getYMDate</a></li><li><a href="global.html#reverseArray">reverseArray</a></li><li><a href="global.html#tableToExcel">tableToExcel</a></li><li><a href="global.html#throttle">throttle</a></li><li><a href="global.html#timeFormatting">timeFormatting</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Fri Mar 22 2024 15:11:50 GMT+0800 (中国标准时间)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
